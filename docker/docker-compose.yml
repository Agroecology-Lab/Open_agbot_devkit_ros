services:
  basekit:
    container_name: open_agbot_basekit
    image: agroecology/open_agbot:latest
    build:
      context: ..
      dockerfile: docker/Dockerfile
    privileged: true
    network_mode: host
    ipc: host
    environment:
      - DISPLAY=${DISPLAY}
      - PYTHONUNBUFFERED=1
    volumes:
      - ../:/workspace
      - /dev:/dev
    # We explicitly map the serial ports
    devices:
      - "/dev/ttyACM0:/dev/ttyACM0"
      - "/dev/ttyACM1:/dev/ttyACM1"
    command: >
      /bin/bash -c "
      source /opt/ros/humble/setup.bash &&
      if [ ! -f '/workspace/install/setup.bash' ]; then
        echo 'ðŸ›‘ Build not found. Waiting...';
        sleep infinity;
      else
        source /workspace/install/setup.bash &&
        ros2 launch basekit_launch basekit.launch.py
      fi"
