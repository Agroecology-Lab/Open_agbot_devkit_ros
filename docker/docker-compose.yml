version: '3.9'

services:
  basekit:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: agroecology/open_agbot:latest
    container_name: open_agbot_basekit
    
    # Required for hardware access (GPS/ESP32)
    privileged: true
    
    # Required for ROS 2 Discovery and NiceGUI web access
    network_mode: host
    
    # Mount hardware device nodes
    volumes:
      - /dev:/dev
    
    environment:
      # Ensures the high-performance middleware we fixed is used
      - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
      # Prevents Python from buffering logs (see logs in real-time)
      - PYTHONUNBUFFERED=1
    
    # Automatically restarts the bot if it crashes or the computer reboots
    restart: unless-stopped

    # Optional: ensure udev is handled if the host has specific rules
    # devices:
    #   - /dev:/dev
